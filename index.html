<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Kiểm tra Công nghệ</title>
    <style>
        /* GIỮ NGUYÊN CSS CŨ CỦA BẠN VÀ THÊM MỘT SỐ STYLE MỚI */
        :root { --p: #2563eb; --s: #16a34a; --e: #dc2626; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; margin: 0; }
        .container { max-width: 850px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .intro-box { text-align: center; padding: 20px; }
        .inp-group { margin: 20px 0; text-align: left; }
        .inp-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #334155; }
        .inp-field { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1.1rem; box-sizing: border-box; transition: 0.3s; }
        .inp-field:focus { border-color: var(--p); outline: none; }
        .btn { width: 100%; padding: 20px; background: var(--p); color: white; border: none; border-radius: 10px; font-size: 1.3rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .timer-bar { display: none; position: fixed; top: 0; left: 0; width: 100%; background: #1e293b; color: #fbbf24; text-align: center; padding: 12px 0; font-size: 1.3rem; font-weight: bold; z-index: 1000; }
        
        /* STYLE CHO LỚP ĐĂNG NHẬP */
        #login-ui { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-top: 10px; }
        .status-open { background: #dcfce7; color: #166534; }
        .status-closed { background: #fee2e2; color: #991b1b; }

        /* GIỮ NGUYÊN CÁC STYLE KHÁC (Hộp câu hỏi, Review, Modal...) */
        .section-header { background: #eff6ff; color: var(--p); padding: 15px; border-radius: 8px; margin: 30px 0 20px; border-left: 6px solid var(--p); font-size: 1.2rem; font-weight: bold; }
        .q-box { margin-bottom: 30px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 10px; }
        .opt { display: flex; align-items: center; padding: 12px; border: 1px solid #f1f5f9; margin: 8px 0; border-radius: 6px; cursor: pointer; }
        .review-opt { padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #eee; display: flex; justify-content: space-between; }
        .opt-correct-choice { background: #dcfce7; border-color: var(--s); }
        .opt-wrong-choice { background: #fee2e2; border-color: var(--e); }
    </style>
</head>
<body>

<div id="login-ui">
    <h2 style="color: #1e293b;">ĐĂNG NHẬP HỆ THỐNG</h2>
    <div class="inp-group">
        <label>Mã truy cập bài thi:</label>
        <input type="password" id="access-code" class="inp-field" placeholder="Nhập mã giáo viên cấp">
    </div>
    <button class="btn" onclick="checkLogin()">VÀO PHÒNG CHỜ</button>
    <div id="time-status" class="status-badge"></div>
</div>

<div class="container" id="intro-ui" style="display: none;">
    <div class="intro-box">
        <h1>THÔNG TIN THÍ SINH</h1>
        <p>Chào mừng bạn, vui lòng hoàn tất thông tin để bắt đầu bài thi.</p>
        <div style="max-width: 400px; margin: 0 auto;">
            <div class="inp-group">
                <label>Họ và tên:</label>
                <input type="text" id="u-name" class="inp-field" placeholder="Nguyễn Văn A">
            </div>
            <div class="inp-group">
                <label>Lớp:</label>
                <input type="text" id="u-class" class="inp-field" placeholder="10A1">
            </div>
            <button class="btn" id="start-btn" onclick="startTest()">BẮT ĐẦU LÀM BÀI</button>
        </div>
    </div>
</div>

<div class="timer-bar" id="timer">THỜI GIAN CÒN LẠI: 15:00</div>
<div class="container" id="quiz-ui" style="display: none;">
    <h1 style="text-align:center;">BÀI KIỂM TRA ĐỊNH KỲ</h1>
    <div style="text-align:center; margin-bottom:20px; font-weight:bold; color:var(--p);" id="display-info"></div>
    <div id="content"></div>
    <button class="btn" onclick="grade()">NỘP BÀI KIỂM TRA</button>
</div>

<div class="container" id="res-ui" style="display: none;">
    <div class="score-card" style="text-align: center; border: 2px solid var(--s); padding: 30px; border-radius: 15px;">
        <h2>KẾT QUẢ BÀI LÀM</h2>
        <div id="res-student-info" style="font-weight: bold; font-size: 1.2rem;"></div>
        <div id="score-val" style="font-size: 3rem; color: var(--p); font-weight: bold;"></div>
        <button onclick="location.reload()" style="margin-top: 20px;">Làm đề khác</button>
    </div>
    <div id="review-list" style="margin-top: 30px;"></div>
</div>

<script>
// --- CẤU HÌNH HỆ THỐNG ---
const CONFIG = {
    PASS_CODE: "CN2026",           // Mật khẩu vào bài thi
    START_TIME: "2024-01-01 07:00:00", // Thời gian mở
    END_TIME: "2026-12-31 23:59:59",   // Thời gian đóng
    TEST_DURATION: 15              // Phút làm bài
};

// --- KIỂM TRA THỜI GIAN KHI TẢI TRANG ---
function updateTimeStatus() {
    const now = new Date();
    const start = new Date(CONFIG.START_TIME);
    const end = new Date(CONFIG.END_TIME);
    const badge = document.getElementById('time-status');
    const startBtn = document.getElementById('start-btn');

    if (now < start) {
        badge.innerText = "Chưa đến giờ làm bài";
        badge.className = "status-badge status-closed";
        if(startBtn) startBtn.disabled = true;
        return false;
    } else if (now > end) {
        badge.innerText = "Hết hạn thời gian làm bài";
        badge.className = "status-badge status-closed";
        if(startBtn) startBtn.disabled = true;
        return false;
    } else {
        badge.innerText = "Hệ thống đang mở";
        badge.className = "status-badge status-open";
        if(startBtn) startBtn.disabled = false;
        return true;
    }
}
setInterval(updateTimeStatus, 1000);

// --- HÀM ĐĂNG NHẬP ---
function checkLogin() {
    const inputCode = document.getElementById('access-code').value;
    if (inputCode === CONFIG.PASS_CODE) {
        if (!updateTimeStatus()) {
            alert("Đăng nhập đúng nhưng hệ thống hiện đang đóng (ngoài giờ thi).");
            return;
        }
        document.getElementById('login-ui').style.display = 'none';
        document.getElementById('intro-ui').style.display = 'block';
    } else {
        alert("Mã truy cập không chính xác!");
    }
}

// --- GIỮ NGUYÊN TOÀN BỘ BANK DỮ LIỆU CỦA BẠN ---
const BANK_A = [...]; // Copy lại BANK_A cũ của bạn vào đây
const BANK_B = [...]; // Copy lại BANK_B cũ của bạn vào đây
const BANK_C = [...]; // Copy lại BANK_C cũ của bạn vào đây
const BANK_P1 = [...]; // Copy lại BANK_P1 cũ của bạn vào đây
const BANK_P2 = [...]; // Copy lại BANK_P2 cũ của bạn vào đây

let studentName = "", studentClass = "", examData = [];
let timerVal = CONFIG.TEST_DURATION * 60;
let countdown;

function startTest() {
    studentName = document.getElementById('u-name').value.trim();
    studentClass = document.getElementById('u-class').value.trim();
    if (!studentName || !studentClass) {
        alert("Vui lòng điền đủ thông tin!");
        return;
    }
    document.getElementById('intro-ui').style.display = 'none';
    document.getElementById('quiz-ui').style.display = 'block';
    document.getElementById('timer').style.display = 'block';
    document.getElementById('display-info').innerText = `${studentName} - Lớp: ${studentClass}`;
    generateQuestions();
    startTimer();
}

// ... (Các hàm startTimer, generateQuestions, grade giữ nguyên như code cũ bạn đã gửi) ...

</script>
</body>
</html>
